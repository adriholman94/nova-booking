<div class="jumbotron jumbotron-fluid">
  <div class="col-12 results-filter-block">
    <%= puts filterrific.inspect %>
    <%= form_for_filterrific(filterrific, url: welcome_results_path, html: {id: :manual_filterrific_form}) do |f| %>
      <div class="form-group">
        <div class="row has-search d-flex align-items-center results-block">
          <%= f.text_field :search_query, placeholder: "¿A dónde vas?",
                           :class => 'filterrific-periodically-observed form-control',
                           :value => params[:city] %>
        </div>
        <div class="row has-search d-flex align-items-center results-block">
          <%= f.text_field(:with_date_gte, placeholder: "Fecha de entrada", class: 'input-sm form-control date_start',
                           :'id' => 'with_date_gte',
                           :'value' => params[:from],
                           readonly: true) %>
        </div>
        <div class="row has-search d-flex align-items-center results-block">
          <%= f.text_field(:with_date_lte, placeholder: "Fecha de salida", class: 'input-sm form-control date_end',
                           :'id' => 'with_date_lte',
                           :'value' => params[:to],
                           readonly: true) %>
        </div>
        <div class="row has-search d-flex align-items-center results-block">
          <%= f.submit :Buscar, class: 'form-control btn btn-primary' %>
        </div>
      </div>
    <% end %>
  </div>
</div>
<script>
    $(function () {
        let fromD = new Date(new Date($("#with_date_gte").val()).toDateString());
        let toD = new Date(new Date($("#with_date_lte").val()).toDateString());
        let ToEndDate = new Date();
        let newEndDate = new Date();
        let newStartDate = new Date();
        toD.setDate(toD.getDate() + 1);
        fromD.setDate(fromD.getDate() + 1);
        ToEndDate.setDate(ToEndDate.getDate() + 365);
        newEndDate.setDate(toD.getDate() - 1);
        newStartDate.setDate(fromD.getDate() + 1);
        $('#with_date_gte').datepicker({
            weekStart: 1,
            startDate: new Date(),
            endDate: newEndDate,
            autoclose: true,
            orientation: "bottom auto",
            format: "dd MM yyyy",
            language: 'es',
            todayHighlight: true,
            forceParse: 0
        }).datepicker('setDate', fromD).datepicker('update').on('changeDate', function (selected) {
            fromD = new Date(selected.date.valueOf());
            let date = new Date();
            date.setDate(fromD.getDate() + 1);
            $('#with_date_lte').datepicker('setStartDate', date);
        });
        $('#with_date_lte').datepicker({
            weekStart: 1,
            startDate: newStartDate,
            endDate: ToEndDate,
            autoclose: true,
            orientation: "bottom auto",
            format: "dd MM yyyy",
            language: 'es',
            todayHighlight: true,
            forceParse: 0
        }).datepicker('setDate', newStartDate).datepicker('update').on('changeDate', function (selected) {
            toD = new Date(selected.date.valueOf());
            let date = new Date();
            date.setDate(toD.getDate() - 1);
            $('#with_date_gte').datepicker('setEndDate', date);
        });
        $(".number").on("keyup", function (event) {
            let input = $(event.target).val();
            input = input.replace(/[\D\s\._\-]+/g, "");
            input = input ? parseInt(input, 10) : 0;
            $(event.target).val(function () {
                let num = (input === 0) ? "" : input.toLocaleString("en-US");
                return num.split(",").join(".");
            });
        });
    });
</script>